angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$rootScope","$translate","$log","realTimeService","randomService","levelsService","drawService","config",function(a,b,c,d,e,f,g,h){"use strict";function i(a){function b(a){N=new window.FPSMeter({graph:!0,theme:"light",left:"20px"}),S=a.yourPlayerIndex,R=a.playersInfo,T=a.matchController,P=!0,Q=1===R.length,G=0,D=[],F=[];for(var b=0;b<R.length;b++)D[b]=s(b),K=t(),F[b]=0;E=D[S],u(),H="right",J=(new Date).getTime(),L=J,k()}function c(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);for(D[b]=d.a,F[b]=d.s;G<d.f;)u()}function d(a){F=a,P=!1,l()}function h(a){if(!Q&&P){var b=angular.toJson({f:G,s:F[S],a:E});a?T.sendReliableMessage(b):T.sendUnreliableMessage(b)}}function i(){P&&(P=!1,T.endMatch(F))}function k(){l();var a=Math.max(50,p-10*Math.floor(G/2));O=setInterval(v,a)}function l(){clearInterval(O)}function s(a){for(var b=q,c=[],d=b-1;d>=0;d--)c.push({x:d,y:j/m-3-a});return c}function t(){var a=[],b=e.randomFromTo(0,0,f.getNumberOfLevels);M=f.getLevel(b);for(var c=M.map,d=0;d<c.length;d++)for(var g=0;g<c[d].length;g++)-1!==c[d][g]&&a.push({x:g,y:d});return a}function u(){function a(a){for(var b=e.randomFromTo(2*G,0,o),c=e.randomFromTo(2*G+1,0,n);a.length>b&&a[b].length>c&&1===a[b][c];)b=e.randomFromTo(2*G,0,o),c=e.randomFromTo(2*G+1,0,n);return{x:b,y:c}}var b=a(K);I={x:b.x,y:b.y},G++,k()}function v(){if(U||void 0===N||N.tickStart(),!U&&P){var a=Math.floor(((new Date).getTime()-J)/1e3);if(r>a){W=[],x();var b=r-a;return g.draw_prompt(V,S,b,M.level),void N.tick()}L=(new Date).getTime()-J,A(I,L),z();var c=E[0].x,d=E[0].y;if("right"===H?c++:"left"===H?c--:"up"===H?d--:"down"===H&&d++,-1===c||c===o||-1===d||d===n||y(c,d,E))return void i();var e,f=!1;if(c===I.x&&d===I.y)return i(),f=!0,e={x:c,y:d},F[S]++,void u();e=E.pop(),e.x=c,e.y=d,E.unshift(e),h(f),x(),N.tick()}}function w(){U?U&&(k(),U=!1):(clearInterval(O),U=!0)}function x(){g.draw_canvas(V,D,S,E,K,J,I,F,R.length)}function y(a,b,c){for(var d=0;d<c.length;d++)if(c[d].x===a&&c[d].y===b)return!0;for(var e=0;e<K.length;e++)if(K[e].x===a&&K[e].y===b)return!0;return!1}function z(){var a=W.shift();a&&("left"===a&&"right"!==H?H="left":"up"===a&&"down"!==H?H="up":"right"===a&&"left"!==H?H="right":"down"===a&&"up"!==H&&(H="down"))}function A(a,b){b/M.bomb_speed>G&&u()}function B(a){W.length>0&&W[W.length-1]===a||W.push(a)}function C(a){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===X)return X=b.pageX,void(Y=b.pageY);var c=b.pageX-X,d=b.pageY-Y,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(X=b.pageX,Y=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",B(e))}}var D,E,F,G,H,I,J,K,L,M,N,O,P=!1,Q=!1,R=null,S=null,T=null,U=!1,V=a.getContext("2d");document.getElementById("help").addEventListener("click",function(){w()},!1),document.getElementById("close").addEventListener("click",function(){w()},!1),document.getElementById("closeTimes").addEventListener("click",function(){w()},!1);var W=[];document.addEventListener("keydown",function(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":80===b?"paused":40===b?"down":null;"paused"===c?w():null!==c&&B(c)},!1);var X=null,Y=null;return a.addEventListener("touchstart",function(a){X=null,Y=null,C(a)},!1),a.addEventListener("touchmove",function(a){C(a)},!1),a.addEventListener("touchend",function(a){C(a)},!1),{gotStartMatch:b,gotMessage:c,gotEndMatch:d}}var j=h.CANVAS.WIDTH,k=h.CANVAS.HEIGHT,l=h.CELL.WIDTH,m=h.CELL.HEIGHT,n=j/l,o=k/m,p=150,q=6,r=h.COUNT_DOWN_TO_START;a.isHelpModalShown=!1,d.init({createCanvasController:i,canvasWidth:j,canvasHeight:k})}]),angular.module("myApp").constant("config",{CANVAS:{WIDTH:300,HEIGHT:300},CELL:{WIDTH:15,HEIGHT:15},COUNT_DOWN_TO_START:1}),angular.module("myApp").service("drawService",["$log","$translate","config",function(a,b,c){"use strict";function d(a,c,d,e){var f=l[c];a.fillStyle=f,a.font="80px Open Sans",a.fillText(""+d,m/2,n/2),a.font="15px Open Sans";var g=b("MAP")+e+": "+b("YOUR_TANK_COLOR_IS",{color:b(f.toUpperCase())});a.fillText(g,m/4-30,n/4-30)}function e(a,b,c){a.globalAlpha=1;for(var d=0;d<b.length;d++){var e=b[d],f=l[c],g=e.x,h=e.y;a.globalAlpha=1-d/b.length,a.fillStyle=f,0===d?a.fillRect(g*o,h*p,o,p):a.fillRect(g*o,h*p,o,p),a.strokeStyle="white",a.shadowColor="rgba(0, 0, 0, 0.2)",a.strokeRect(g*o,h*p,o,p)}a.globalAlpha=1}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.x,f=d.y;a.fillStyle="brown",a.fillRect(e*q,f*r,q,r),a.strokeStyle="white",a.strokeRect(e*q,f*r,q,r)}}function g(a,c){var d=(new Date).getTime()-c-1e3*s;if(d>0){var e=(new Date).getTime()-c-1e3*s,f=Math.floor(e/1e3),g=Math.floor((e-1e3*f)/10);d=f+":"+g}else d="0:00";a.font="12px Open Sans",a.fillStyle="black";var h=b("TIMER")+": "+b("TIMER_IS",{timer:d});a.fillText(h,m/4-30,n-5)}function h(a,b,c,d){a.fillStyle=d,a.fillRect(b*o,c*p,o,p),a.strokeStyle="white",a.strokeRect(b*o,c*p,o,p)}function i(a,c,d){for(var e=0;e<c.length;e++){a.font="12px Open Sans";var f=l[e];a.fillStyle=f;var g=b("COLOR_SCORE_IS",{color:b(f.toUpperCase()),score:""+c[e]});a.fillText(g,5+e*m/d,n-5)}}function j(a,b){a.fillStyle="rgba(255, 255, 255, 1)",a.strokeStyle="black",a.shadowColor="rgba(0, 0, 0, 0.2)",a.shadowBlur=15,a.fillRect(m/2-150,n/2-150,300,300),a.strokeRect(m/2-150,n/2-150,300,300),t(a),a.fillStyle="black",a.font="600 32px Open Sans",a.textAlign="center",a.fillText(b,m/2,n/2),a.fillStyle="rgba(0, 0, 0, 0.65)",a.font="20px Open Sans",a.fillText("Space to continue",m/2,n/2+35)}function k(a,b,c,d,j,k,l,o,p){a.fillStyle="white",a.fillRect(0,0,m,n),a.strokeStyle="black",a.strokeRect(0,0,m,n);for(var q=0;q<b.length;q++)q!==c&&e(b[q],q);e(a,d,c),f(a,j),g(a,k),h(a,l.x,l.y,"green"),i(a,o,p)}var l=["blue","red","brown","purple","pink","yellow","orange","silver"],m=c.CANVAS.WIDTH,n=c.CANVAS.HEIGHT,o=c.CELL.WIDTH,p=c.CELL.HEIGHT,q=15,r=15,s=c.COUNT_DOWN_TO_START,t=function(a){a.shadowColor=0,a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0};return{draw_canvas:k,draw_prompt:d,draw_tank:e,draw_wall:f,draw_bomb:h,draw_score:i,draw_timer:g,show_dialogue:j}}]),angular.module("myApp").service("levelsService",[function(){"use strict";function a(a){return b[a]}var b=[{level:1,map:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1],[]],bomb_speed:1e5},{level:2,map:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1],[]],bomb_speed:5e3},{level:3,map:[[],[],[],[],[],[],[],[1,1],[-1,-1,-1,1],[-1,-1,-1,1,1,1,1,-1,1],[],[-1,1,-1,-1,-1],[-1,1,-1,-1,-1],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1],[]],bomb_speed:3e3}];return{getNumberOfLevels:b.length,getLevel:a}}]);
//# sourceMappingURL=tank.min.js.map