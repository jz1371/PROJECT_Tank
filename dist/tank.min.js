angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$rootScope","$translate","$log","realTimeService","randomService","levelsService","drawService","config",function(a,b,c,d,e,f,g,h){"use strict";function i(b){function c(b){T=b.yourPlayerIndex,S=b.playersInfo,U=b.matchController,Q=!0,R=1===S.length,u=R,a.isSinglePlayer=u,J=0,G=[],I=[];for(var c=0;c<S.length;c++)G[c]=w(c),M=x(),I[c]=0;H=G[T],y(),K="right",s=(new Date).getTime(),N=s,l()}function d(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);for(G[b]=d.a,I[b]=d.s;J<d.f;)y()}function h(a){I=a,Q=!1,t()}function i(a){if(!R&&Q){var b=angular.toJson({f:J,s:I[T],a:H});a?U.sendReliableMessage(b):U.sendUnreliableMessage(b)}}function k(){Q&&(Q=!1,U.endMatch(I))}function l(){t();var a=Math.max(50,p-10*Math.floor(J/2));P=setInterval(z,a)}function t(){clearInterval(P)}function w(a){for(var b=q,c=[],d=b-1;d>=0;d--)c.push({x:d,y:j/m-3-a});return c}function x(){var a=[],b=e.randomFromTo(0,0,f.getNumberOfLevels);O=f.getLevel(b);for(var c=O.map,d=0;d<c.length;d++)for(var g=0;g<c[d].length;g++)-1!==c[d][g]&&a.push({x:g,y:d});return a}function y(){function a(a){for(var b=e.randomFromTo(2*J,0,o),c=e.randomFromTo(2*J+1,0,n);a.length>b&&a[b].length>c&&1===a[b][c];)b=e.randomFromTo(2*J,0,o),c=e.randomFromTo(2*J+1,0,n);return{x:b,y:c}}var b=a(M);L={x:b.x,y:b.y},J++,l()}function z(){if(!v&&Q){var a=Math.floor(((new Date).getTime()-s)/1e3);if(r>a){W=[],A();var b=r-a;return void g.draw_prompt(V,T,b,O.level)}N=(new Date).getTime()-s,D(L,N),C();var c=H[0].x,d=H[0].y;if("right"===K?c++:"left"===K?c--:"up"===K?d--:"down"===K&&d++,-1===c||c===o||-1===d||d===n||B(c,d,H))return void k();var e,f=!1;if(c===L.x&&d===L.y)return k(),f=!0,e={x:c,y:d},I[T]++,void y();e=H.pop(),e.x=c,e.y=d,H.unshift(e),i(f),A()}}function A(){g.draw_canvas(V,G,T,H,M,s,L,I,S.length)}function B(a,b,c){for(var d=0;d<c.length;d++)if(c[d].x===a&&c[d].y===b)return!0;for(var e=0;e<M.length;e++)if(M[e].x===a&&M[e].y===b)return!0;return!1}function C(){var a=W.shift();a&&("left"===a&&"right"!==K?K="left":"up"===a&&"down"!==K?K="up":"right"===a&&"left"!==K?K="right":"down"===a&&"up"!==K&&(K="down"))}function D(a,b){b/O.bomb_speed>J&&y()}function E(a){W.length>0&&W[W.length-1]===a||W.push(a)}function F(a){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===X)return X=b.pageX,void(Y=b.pageY);var c=b.pageX-X,d=b.pageY-Y,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(X=b.pageX,Y=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",E(e))}}var G,H,I,J,K,L,M,N,O,P,Q=!1,R=!1,S=null,T=null,U=null,V=b.getContext("2d");a.stopDrawInterval=t;var W=[];document.addEventListener("keydown",function(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&E(c)},!1);var X=null,Y=null;return b.addEventListener("touchstart",function(a){X=null,Y=null,F(a)},!1),b.addEventListener("touchmove",function(a){F(a)},!1),b.addEventListener("touchend",function(a){F(a)},!1),{gotStartMatch:c,gotMessage:d,gotEndMatch:h}}var j=h.CANVAS.WIDTH,k=h.CANVAS.HEIGHT,l=h.CELL.WIDTH,m=h.CELL.HEIGHT,n=j/l,o=k/m,p=150,q=6,r=h.COUNT_DOWN_TO_START;a.isHelpModalShown=!1,a.isSinglePlayer=!1;var s,t,u=!1,v=!1;a.carouselClick=function(){u&&(a.isHelpModalShown=!0,v=!0,t=(new Date).getTime()-s)},a.carouselClose=function(){a.isHelpModalShown=!1,v=!1,s=(new Date).getTime()-t},d.init({createCanvasController:i,canvasWidth:j,canvasHeight:k})}]),angular.module("myApp").constant("config",{CANVAS:{WIDTH:300,HEIGHT:300},CELL:{WIDTH:15,HEIGHT:15},COUNT_DOWN_TO_START:4}),angular.module("myApp").service("drawService",["$log","$translate","config",function(a,b,c){"use strict";function d(a,c,d,e){var f=l[c];a.fillStyle=f,a.font="80px Open Sans",a.fillText(""+d,m/2,n/2),a.font="15px Open Sans";var g=b("MAP")+e+": "+b("YOUR_TANK_COLOR_IS",{color:b(f.toUpperCase())});a.fillText(g,m/4-30,n/4-30)}function e(a,b,c){a.globalAlpha=1;for(var d=0;d<b.length;d++){var e=b[d],f=l[c],g=e.x,h=e.y;a.globalAlpha=1-d/b.length,a.fillStyle=f,0===d?a.fillRect(g*o,h*p,o,p):a.fillRect(g*o,h*p,o,p),a.strokeStyle="white",a.shadowColor="rgba(0, 0, 0, 0.2)",a.strokeRect(g*o,h*p,o,p)}a.globalAlpha=1}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.x,f=d.y;a.fillStyle="brown",a.fillRect(e*q,f*r,q,r),a.strokeStyle="white",a.strokeRect(e*q,f*r,q,r)}}function g(a,c){var d=(new Date).getTime()-c-1e3*s;if(d>0){var e=(new Date).getTime()-c-1e3*s,f=Math.floor(e/1e3),g=Math.floor((e-1e3*f)/10);d=f+":"+g}else d="0:00";a.font="12px Open Sans",a.fillStyle="black";var h=b("TIMER")+": "+b("TIMER_IS",{timer:d});a.fillText(h,m/4-30,n-5)}function h(a,b,c,d){a.fillStyle=d,a.fillRect(b*o,c*p,o,p),a.strokeStyle="white",a.strokeRect(b*o,c*p,o,p)}function i(a,c,d){for(var e=0;e<c.length;e++){a.font="12px Open Sans";var f=l[e];a.fillStyle=f;var g=b("COLOR_SCORE_IS",{color:b(f.toUpperCase()),score:""+c[e]});a.fillText(g,5+e*m/d,n-5)}}function j(a,b){a.fillStyle="rgba(255, 255, 255, 1)",a.strokeStyle="black",a.shadowColor="rgba(0, 0, 0, 0.2)",a.shadowBlur=15,a.fillRect(m/2-150,n/2-150,300,300),a.strokeRect(m/2-150,n/2-150,300,300),t(a),a.fillStyle="black",a.font="600 32px Open Sans",a.textAlign="center",a.fillText(b,m/2,n/2),a.fillStyle="rgba(0, 0, 0, 0.65)",a.font="20px Open Sans",a.fillText("Space to continue",m/2,n/2+35)}function k(a,b,c,d,j,k,l,o,p){a.fillStyle="white",a.fillRect(0,0,m,n),a.strokeStyle="black",a.strokeRect(0,0,m,n);for(var q=0;q<b.length;q++)q!==c&&e(b[q],q);e(a,d,c),f(a,j),g(a,k),h(a,l.x,l.y,"green"),i(a,o,p)}var l=["blue","red","brown","purple","pink","yellow","orange","silver"],m=c.CANVAS.WIDTH,n=c.CANVAS.HEIGHT,o=c.CELL.WIDTH,p=c.CELL.HEIGHT,q=15,r=15,s=c.COUNT_DOWN_TO_START,t=function(a){a.shadowColor=0,a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0};return{draw_canvas:k,draw_prompt:d,draw_tank:e,draw_wall:f,draw_bomb:h,draw_score:i,draw_timer:g,show_dialogue:j}}]),angular.module("myApp").service("levelsService",[function(){"use strict";function a(a){return b[a]}var b=[{level:1,map:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1],[]],bomb_speed:1e5},{level:2,map:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1],[]],bomb_speed:5e3},{level:3,map:[[],[],[],[],[],[],[],[1,1],[-1,-1,-1,1],[-1,-1,-1,1,1,1,1,-1,1],[],[-1,1,-1,-1,-1],[-1,1,-1,-1,-1],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1],[]],bomb_speed:3e3}];return{getNumberOfLevels:b.length,getLevel:a}}]);
//# sourceMappingURL=tank.min.js.map