angular.module("myApp",[]).run(["$translate","$log","realTimeService","randomService","levelsService","drawService","config",function(a,b,c,d,e,f,g){"use strict";function h(a){function b(a){M=new window.FPSMeter({graph:!0,theme:"light",left:"20px"}),R=a.yourPlayerIndex,Q=a.playersInfo,S=a.matchController,O=!0,P=1===Q.length,F=0,C=[],E=[];for(var b=0;b<Q.length;b++)C[b]=s(b),J=t(),E[b]=0;D=C[R],u(),G="right",I=(new Date).getTime(),K=I,k()}function c(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);for(C[b]=d.a,E[b]=d.s;F<d.f;)u()}function g(a){E=a,O=!1,r()}function h(a){if(!P&&O){var b=angular.toJson({f:F,s:E[R],a:D});a?S.sendReliableMessage(b):S.sendUnreliableMessage(b)}}function j(){O&&(O=!1,S.endMatch(E))}function k(){r();var a=Math.max(50,o-10*Math.floor(F/2));N=setInterval(v,a)}function r(){clearInterval(N)}function s(a){for(var b=p,c=[],d=b-1;d>=0;d--)c.push({x:d,y:i/l-3-a});return c}function t(){var a=[],b=d.randomFromTo(0,0,e.getNumberOfLevels);L=e.getLevel(b);for(var c=L.map,f=0;f<c.length;f++)for(var g=0;g<c[f].length;g++)-1!==c[f][g]&&a.push({x:g,y:f});return a}function u(){function a(a){for(var b=d.randomFromTo(2*F,0,n),c=d.randomFromTo(2*F+1,0,m);a.length>b&&a[b].length>c&&1===a[b][c];)b=d.randomFromTo(2*F,0,n),c=d.randomFromTo(2*F+1,0,m);return{x:b,y:c}}var b=a(J);H={x:b.x,y:b.y},F++,k()}function v(){if(M.tickStart(),O){var a=Math.floor(((new Date).getTime()-I)/1e3);if(q>a){U=[],w();var b=q-a;return f.draw_prompt(T,R,b,L.level),void M.tick()}K=(new Date).getTime()-I,z(H,K),y();var c=D[0].x,d=D[0].y;if("right"===G?c++:"left"===G?c--:"up"===G?d--:"down"===G&&d++,-1===c||c===n||-1===d||d===m||x(c,d,D))return void j();var e,g=!1;if(c===H.x&&d===H.y)return j(),g=!0,e={x:c,y:d},E[R]++,void u();e=D.pop(),e.x=c,e.y=d,D.unshift(e),h(g),w(),M.tick()}}function w(){f.draw_canvas(T,C,R,D,J,I,H,E,Q.length)}function x(a,b,c){for(var d=0;d<c.length;d++)if(c[d].x===a&&c[d].y===b)return!0;for(var e=0;e<J.length;e++)if(J[e].x===a&&J[e].y===b)return!0;return!1}function y(){var a=U.shift();a&&("left"===a&&"right"!==G?G="left":"up"===a&&"down"!==G?G="up":"right"===a&&"left"!==G?G="right":"down"===a&&"up"!==G&&(G="down"))}function z(a,b){b/L.bomb_speed>F&&u()}function A(a){U.length>0&&U[U.length-1]===a||U.push(a)}function B(a){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===V)return V=b.pageX,void(W=b.pageY);var c=b.pageX-V,d=b.pageY-W,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(V=b.pageX,W=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",A(e))}}var C,D,E,F,G,H,I,J,K,L,M,N,O=!1,P=!1,Q=null,R=null,S=null,T=a.getContext("2d"),U=[];document.addEventListener("keydown",function(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&A(c)},!1);var V=null,W=null;return a.addEventListener("touchstart",function(a){V=null,W=null,B(a)},!1),a.addEventListener("touchmove",function(a){B(a)},!1),a.addEventListener("touchend",function(a){B(a)},!1),{gotStartMatch:b,gotMessage:c,gotEndMatch:g}}var i=g.CANVAS.WIDTH,j=g.CANVAS.HEIGHT,k=g.CELL.WIDTH,l=g.CELL.HEIGHT,m=i/k,n=j/l,o=150,p=6,q=g.COUNT_DOWN_TO_START;c.init({createCanvasController:h,canvasWidth:i,canvasHeight:j})}]),angular.module("myApp").constant("config",{CANVAS:{WIDTH:300,HEIGHT:300},CELL:{WIDTH:15,HEIGHT:15},COUNT_DOWN_TO_START:1}),angular.module("myApp").service("drawService",["$log","$translate","config",function(a,b,c){"use strict";function d(a,c,d,e){var f=l[c];a.fillStyle=f,a.font="80px Open Sans",a.fillText(""+d,m/2,n/2),a.font="15px Open Sans";var g=b("MAP")+e+": "+b("YOUR_TANK_COLOR_IS",{color:b(f.toUpperCase())});a.fillText(g,m/4-30,n/4-30)}function e(a,b,c){a.globalAlpha=1;for(var d=0;d<b.length;d++){var e=b[d],f=l[c],g=e.x,h=e.y;a.globalAlpha=1-d/b.length,a.fillStyle=f,0===d?a.fillRect(g*o,h*p,o,p):a.fillRect(g*o,h*p,o,p),a.strokeStyle="white",a.shadowColor="rgba(0, 0, 0, 0.2)",a.strokeRect(g*o,h*p,o,p)}a.globalAlpha=1}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.x,f=d.y;a.fillStyle="brown",a.fillRect(e*q,f*r,q,r),a.strokeStyle="white",a.strokeRect(e*q,f*r,q,r)}}function g(a,c){var d=(new Date).getTime()-c-1e3*s;if(d>0){var e=(new Date).getTime()-c-1e3*s,f=Math.floor(e/1e3),g=Math.floor((e-1e3*f)/10);d=f+":"+g}else d="0:00";a.font="12px Open Sans",a.fillStyle="black";var h=b("TIMER")+": "+b("TIMER_IS",{timer:d});a.fillText(h,m/4-30,n-5)}function h(a,b,c,d){a.fillStyle=d,a.fillRect(b*o,c*p,o,p),a.strokeStyle="white",a.strokeRect(b*o,c*p,o,p)}function i(a,c,d){for(var e=0;e<c.length;e++){a.font="12px Open Sans";var f=l[e];a.fillStyle=f;var g=b("COLOR_SCORE_IS",{color:b(f.toUpperCase()),score:""+c[e]});a.fillText(g,5+e*m/d,n-5)}}function j(a,b){a.fillStyle="rgba(255, 255, 255, 1)",a.strokeStyle="black",a.shadowColor="rgba(0, 0, 0, 0.2)",a.shadowBlur=15,a.fillRect(m/2-150,n/2-150,300,300),a.strokeRect(m/2-150,n/2-150,300,300),t(a),a.fillStyle="black",a.font="600 32px Open Sans",a.textAlign="center",a.fillText(b,m/2,n/2),a.fillStyle="rgba(0, 0, 0, 0.65)",a.font="20px Open Sans",a.fillText("Space to continue",m/2,n/2+35)}function k(a,b,c,d,j,k,l,o,p){a.fillStyle="white",a.fillRect(0,0,m,n),a.strokeStyle="black",a.strokeRect(0,0,m,n);for(var q=0;q<b.length;q++)q!==c&&e(b[q],q);e(a,d,c),f(a,j),g(a,k),h(a,l.x,l.y,"green"),i(a,o,p)}var l=["blue","red","brown","purple","pink","yellow","orange","silver"],m=c.CANVAS.WIDTH,n=c.CANVAS.HEIGHT,o=c.CELL.WIDTH,p=c.CELL.HEIGHT,q=15,r=15,s=c.COUNT_DOWN_TO_START,t=function(a){a.shadowColor=0,a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0};return{draw_canvas:k,draw_prompt:d,draw_tank:e,draw_wall:f,draw_bomb:h,draw_score:i,draw_timer:g,show_dialogue:j}}]),angular.module("myApp").service("levelsService",[function(){"use strict";function a(a){return b[a]}var b=[{level:1,map:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1],[]],bomb_speed:1e5},{level:2,map:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1],[]],bomb_speed:5e3},{level:3,map:[[],[],[],[],[],[],[],[1,1],[-1,-1,-1,1],[-1,-1,-1,1,1,1,1,-1,1],[],[-1,1,-1,-1,-1],[-1,1,-1,-1,-1],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1],[]],bomb_speed:3e3}];return{getNumberOfLevels:b.length,getLevel:a}}]);
//# sourceMappingURL=tank.min.js.map